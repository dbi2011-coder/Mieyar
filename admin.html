<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุจุงุฏุฑุฉ ูุนูุงุฑ - ูุงุฌูุฉ ุงููุณุคูู</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-container">
                <img src="images/logo.png" alt="ุดุนุงุฑ ูุจุงุฏุฑุฉ ูุนูุงุฑ" class="logo">
            </div>
            <div class="title-container">
                <h1>ูุจุงุฏุฑุฉ ูุนูุงุฑ - ูุงุฌูุฉ ุงููุณุคูู</h1>
                <p class="subtitle">ูุดุฑูุน ุชุฏุฑูุจ ููุทูุงุจ ุนูู ุงูุงุฎุชุจุงุฑุงุช ุงููุนูุงุฑูุฉ ูุชุญุณูู ุฌูุฏุฉ ุฃุฏุงุฆูู</p>
            </div>
        </div>
        <div class="admin-info">
            <span>ูุฑุญุจุงูุ ุงููุณุคูู</span>
            <button id="logout-btn" class="btn-danger">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
        </div>
    </header>
    
    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" data-tab="questions">ุฅุฏุงุฑุฉ ุงูุฃุณุฆูุฉ</button>
            <button class="tab-btn" data-tab="reports">ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช</button>
            <button class="tab-btn" data-tab="settings">ุงูุฅุนุฏุงุฏุงุช</button>
        </div>
        
        <!-- ูุณู ุฅุฏุงุฑุฉ ุงูุฃุณุฆูุฉ -->
        <div id="questions" class="tab-content active">
            <h2>ุฅุถุงูุฉ ุณุคุงู ุฌุฏูุฏ</h2>
            <form id="add-question-form">
                <div class="form-group" id="standard-question-group">
                    <label for="question-text">ูุต ุงูุณุคุงู</label>
                    <textarea id="question-text" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="question-type">ููุน ุงูุณุคุงู</label>
                    <select id="question-type">
                        <option value="multiple">ุงุฎุชูุงุฑ ูู ูุชุนุฏุฏ</option>
                        <option value="multiple-with-media">ุงุฎุชูุงุฑ ูู ูุชุนุฏุฏ ูุน ูุฑูู</option>
                        <option value="reading-comprehension">ุงุณุชูุนุงุจ ุงูููุฑูุก</option>
                    </select>
                </div>
                
                <div class="form-group" id="reading-passage-group" style="display: none;">
                    <label for="reading-passage">ูุทุนุฉ ุงูุงุณุชูุนุงุจ</label>
                    <textarea id="reading-passage" rows="5" placeholder="ุฃุฏุฎู ูุต ุงููุทุนุฉ ููุง..." required></textarea>
                </div>
                
                <div id="reading-questions-container" style="display: none;">
                    <h3>ุฃุณุฆูุฉ ุงููุทุนุฉ</h3>
                    <div id="reading-questions-list"></div>
                    <button type="button" id="add-reading-question" class="btn-primary">ุฅุถุงูุฉ ุณุคุงู ูููุทุนุฉ</button>
                </div>
                
                <div class="form-group" id="media-url-group" style="display: none;">
                    <label for="media-url">ุฑุงุจุท ุงูููุชููุจ ุฃู ุงูุตูุฑุฉ</label>
                    <input type="url" id="media-url" placeholder="https://example.com/video.jpg ุฃู https://youtube.com/watch?v=...">
                </div>
                
                <div id="standard-options-section">
                    <div class="form-group" id="standard-options-group">
                        <label>ุนุฏุฏ ุงูุฎูุงุฑุงุช</label>
                        <select id="options-count">
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4" selected>4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                        </select>
                    </div>
                    
                    <div id="options-container"></div>
                    
                    <div class="form-group" id="correct-answer-group">
                        <label>ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ</label>
                        <div id="correct-answer-container"></div>
                    </div>
                </div>
                
                <button type="submit" class="btn-success">ุฅุถุงูุฉ ุงูุณุคุงู</button>
            </form>
            
            <h2 style="margin-top: 2rem;">ุจูู ุงูุฃุณุฆูุฉ</h2>
            <div id="questions-list"></div>
        </div>
        
        <!-- ูุณู ุงูุชูุงุฑูุฑ -->
        <div id="reports" class="tab-content">
            <h2>ุชูุงุฑูุฑ ุงูุทูุงุจ ูุงูุฅุญุตุงุฆูุงุช</h2>
            
            <div class="statistics-card">
                <h3>ุงููุณุจุฉ ุงูุนุงูุฉ ูุฌููุน ุงูุทูุงุจ</h3>
                <div id="overall-percentage" class="percentage-display">0%</div>
                <p>ูุฌููุน ูุณุจ ุฌููุน ุงูุทูุงุจ รท ุนุฏุฏ ุงูุทูุงุจ</p>
            </div>
            
            <div class="form-group">
                <label for="top-students-count">ุนุฏุฏ ุงูุทูุงุจ ุงููุทููุจ ุนุฑุถูู (ุงูุฃูุถู ุฃุฏุงุกู)</label>
                <input type="number" id="top-students-count" min="1" value="5">
                <button id="show-top-students" class="btn-success" style="margin-top: 10px;">ุนุฑุถ ุงูุฃูุถู ุฃุฏุงุกู</button>
            </div>
            
            <div class="form-group" style="margin-top: 20px;">
                <h3>ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงูุทูุงุจ</h3>
                <button id="delete-all-students" class="btn-danger">ุญุฐู ุฌููุน ุงูุทูุงุจ ููุชุงุฆุฌูู</button>
                <button id="delete-selected-students" class="btn-warning">ุญุฐู ูุญุฏุฏ</button>
            </div>
            
            <table id="students-report">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="select-all-students"> ุชุญุฏูุฏ ุงููู</th>
                        <th>ุงุณู ุงูุทุงูุจ</th>
                        <th>ุงููุณุจุฉ ุงููุฆููุฉ</th>
                        <th>ุงูููุช ุงููุณุชุบุฑู</th>
                        <th>ุงูุชุงุฑูุฎ</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            
            <button id="print-report" class="btn-success" style="margin-top: 20px;">ุทุจุงุนุฉ ุงูุชูุฑูุฑ</button>
        </div>
        
        <!-- ูุณู ุงูุฅุนุฏุงุฏุงุช -->
        <div id="settings" class="tab-content">
            <h2>ุฅุนุฏุงุฏุงุช ุงูุงุฎุชุจุงุฑ</h2>
            
            <div class="form-group">
                <label for="questions-count">ุนุฏุฏ ุงูุฃุณุฆูุฉ ุงูุชู ุชุธูุฑ ููุทุงูุจ</label>
                <input type="number" id="questions-count" min="1" value="10">
            </div>
            
            <div class="form-group">
                <label for="login-type">ููุน ุฏุฎูู ุงูุทูุงุจ</label>
                <select id="login-type">
                    <option value="open">ุฏุฎูู ููุชูุญ ูุบูุฑ ูุญุฏูุฏ</option>
                    <option value="restricted">ุฏุฎูู ูุญุฏูุฏ (ูุชุทูุจ ุฑูู ูููุฉ/ุฅูุงูุฉ)</option>
                </select>
            </div>
            
            <div class="form-group" id="attempts-count-group" style="display: none;">
                <label for="attempts-count">ุนุฏุฏ ูุฑุงุช ุงููุญุงููุฉ ุงููุณููุญุฉ ููุฏุฎูู ุงููุญุฏูุฏ</label>
                <input type="number" id="attempts-count" min="1" value="1">
                <small>ุณูุชู ุชุทุจูู ูุฐุง ุงูุนุฏุฏ ุนูู ุฌููุน ุงูุทูุงุจ ุงููุตุฑุญ ููู ูู ุงููุงุฆูุฉ ุฃุฏูุงู</small>
            </div>
            
            <div class="form-group">
                <label for="results-display">ุทุฑููุฉ ุนุฑุถ ุงููุชุงุฆุฌ ููุทูุงุจ</label>
                <select id="results-display">
                    <option value="show-answers">ุฅุธูุงุฑ ุงูุฅุฌุงุจุงุช (ุชูุฏูู ุชุบุฐูุฉ ุฑุงุฌุนุฉ)</option>
                    <option value="hide-answers">ุฅุฎูุงุก ุงูุฅุฌุงุจุงุช (ุนุฑุถ ุนุฏุฏ ุงูุฅุฌุงุจุงุช ุงูุตุญูุญุฉ ููุท)</option>
                </select>
            </div>
            
            <button id="save-settings" class="btn-success">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
            
            <div id="authorized-students-section" style="margin-top: 30px; display: none;">
                <h3>ูุงุฆูุฉ ุงูุทูุงุจ ุงููุตุฑุญ ููู ุจุงูุฏุฎูู</h3>
                <div class="form-group">
                    <label for="student-id">ุฑูู ุงููููุฉ/ุงูุฅูุงูุฉ</label>
                    <input type="text" id="student-id" placeholder="ุฃุฏุฎู ุฑูู ุงููููุฉ ุฃู ุงูุฅูุงูุฉ">
                </div>
                <div class="form-group">
                    <label for="student-name">ุงุณู ุงูุทุงูุจ</label>
                    <input type="text" id="student-name" placeholder="ุฃุฏุฎู ุงุณู ุงูุทุงูุจ">
                </div>
                <button id="add-authorized-student" class="btn-primary">ุฅุถุงูุฉ ุทุงูุจ</button>
                
                <table id="authorized-students-list" style="margin-top: 20px; width: 100%;">
                    <thead>
                        <tr>
                            <th>ุฑูู ุงููููุฉ/ุงูุฅูุงูุฉ</th>
                            <th>ุงุณู ุงูุทุงูุจ</th>
                            <th>ุนุฏุฏ ุงููุญุงููุงุช ุงููุณุชุฎุฏูุฉ</th>
                            <th>ุงูุฅุฌุฑุงุกุงุช</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                
                <button id="print-authorized-students" class="btn-success" style="margin-top: 10px;">ุทุจุงุนุฉ ุงููุงุฆูุฉ</button>
            </div>
        </div>
    </div>

    <footer class="credits">
        <p>ุฅุนุฏุงุฏ ูุชุตููู: ุฃ/ ุตุงูุญ ุนุจุฏ ุงูุนุฒูุฒ ุนุจุฏ ุงููู ุงูุนุฌูุงู - ูุนูู ุตุนูุจุงุช ุงูุชุนูู</p>
    </footer>

    <!-- ุชุญููู Supabase ุฃููุงู -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase.js"></script>
    
    <!-- ุซู ุจุงูู ุงููููุงุช -->
    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
    <script src="js/admin.js"></script>
    
    <script>
        // ูุธุงู ูุตุงุฏูุฉ ูุจุณุท ููุจุงุดุฑ
        function checkAdminAuth() {
            console.log('๐ ูุญุต ุงููุตุงุฏูุฉ...');
            
            // ูุญุต ูุจุงุดุฑ ูู localStorage ุจุฏูู ุงุนุชูุงุฏ ุนูู ุฏูุงู Supabase
            const adminLoggedIn = localStorage.getItem('adminLoggedIn');
            const loginTime = localStorage.getItem('adminLoginTime');
            
            console.log('ุจูุงูุงุช ุงููุตุงุฏูุฉ:', { adminLoggedIn, loginTime });
            
            if (!adminLoggedIn || adminLoggedIn !== 'true') {
                console.log('โ ุบูุฑ ูุณุฌู ุฏุฎูู');
                return false;
            }
            
            // ุงูุชุญูู ูู ุงูุชูุงุก ุงูุฌูุณุฉ
            if (loginTime) {
                const loginDate = new Date(loginTime);
                const currentDate = new Date();
                const hoursDiff = (currentDate - loginDate) / (1000 * 60 * 60);
                
                console.log('โฐ ูุฏุฉ ุงูุฌูุณุฉ:', hoursDiff.toFixed(2), 'ุณุงุนุฉ');
                
                if (hoursDiff > 24) {
                    console.log('โ ุงูุชูุช ูุฏุฉ ุงูุฌูุณุฉ');
                    localStorage.removeItem('adminLoggedIn');
                    localStorage.removeItem('adminLoginTime');
                    return false;
                }
            }
            
            console.log('โ ูุณุฌู ุฏุฎูู ุจูุฌุงุญ');
            return true;
        }
        
        // ุชููุฆุฉ ุงูุตูุญุฉ ุจุนุฏ ุชุญููู ูู ุดูุก
        function initializeAdminPage() {
            console.log('๐ ุจุฏุก ุชููุฆุฉ ุตูุญุฉ ุงููุณุคูู...');
            
            // ูุญุต ุงููุตุงุฏูุฉ ุฃููุงู
            if (!checkAdminAuth()) {
                alert('ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู ูููุตูู ุฅูู ูุฐู ุงูุตูุญุฉ');
                window.location.href = 'index.html';
                return;
            }
            
            console.log('โ ุชู ุงูุชุญูู ูู ุงููุตุงุฏูุฉ - ุชููุฆุฉ ุงููุงุฌูุฉ');
            
            // ุชููุฆุฉ ูุงุฌูุฉ ุงููุณุคูู
            if (typeof initAdmin === 'function') {
                console.log('๐ง ุฌุงุฑู ุชููุฆุฉ ูุงุฌูุฉ ุงููุณุคูู...');
                initAdmin();
            } else {
                console.error('โ ุฏุงูุฉ initAdmin ุบูุฑ ููุฌูุฏุฉ');
            }
            
            // ุฅุนุฏุงุฏ ุฒุฑ ุชุณุฌูู ุงูุฎุฑูุฌ
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุชุณุฌูู ุงูุฎุฑูุฌุ')) {
                        localStorage.removeItem('adminLoggedIn');
                        localStorage.removeItem('adminLoginTime');
                        localStorage.removeItem('adminUsername');
                        window.location.href = 'index.html';
                    }
                });
            }
            
            console.log('โ ุชููุฆุฉ ุงูุตูุญุฉ ููุชููุฉ');
        }
        
        // ุงูุงูุชุธุงุฑ ุญุชู ุชุญููู ุฌููุน ุงููููุงุช
        function waitForAllFiles() {
            console.log('โณ ุงูุชุธุงุฑ ุชุญููู ุงููููุงุช...');
            
            // ุงูุชุญูู ูู ุชุญููู ุฌููุน ุงูุฏูุงู ุงูุฃุณุงุณูุฉ
            if (typeof supabase !== 'undefined' && 
                typeof initAdmin !== 'undefined' && 
                typeof isAdminLoggedIn !== 'undefined') {
                console.log('โ ุฌููุน ุงููููุงุช ูุญููุฉ');
                initializeAdminPage();
            } else {
                console.log('๐ ูุง ูุฒุงู ุจุนุถ ุงููููุงุช ุฌุงุฑู ุงูุชุญููู...');
                setTimeout(waitForAllFiles, 100);
            }
        }
        
        // ุจุฏุก ุงูุนูููุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('๐ ุตูุญุฉ ุงููุณุคูู ูุญููุฉ - ุจุฏุก ุงูุชุญูู ูู ุงููููุงุช');
            setTimeout(waitForAllFiles, 300);
        });
    </script>
</body>
</html>
